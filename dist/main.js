!function(e){var t={};function s(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=t,s.d=function(e,t,i){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)s.d(i,n,function(t){return e[t]}.bind(null,n));return i},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/dist/",s(s.s=1)}([function(e,t,s){},function(e,t,s){"use strict";s.r(t);var i=class{constructor(){this.size=3,this.colorTicker=0,this.geometry=new THREE.SphereGeometry(this.size,20,20),this.material=new THREE.MeshBasicMaterial({vertexColors:THREE.FaceColors}),this.sphereShape=new THREE.Mesh(this.geometry,this.material),this.sphereShape.dynamic=!0;let e=this.geometry.faces.length;for(let s=0;s<e;s++){let e=this.geometry.faces[s];var t=new THREE.Color(16777215);let i=.36*Math.random()+.64,n=.36*Math.random()+.64,h=.36*Math.random()+.64;t.setRGB(i,n,h),e.color=t}this.geometry.elementsNeedUpdate=!0,this.sphereShape.position.y=2.5}colorSwitch(e){if(255===e){let e=this.geometry.faces.length;for(let s=0;s<e;s++){let e=this.geometry.faces[s];var t=new THREE.Color(16777215);let i=.36*Math.random()+.64,n=.36*Math.random()+.64,h=.36*Math.random()+.64;t.setRGB(i,n,h),e.color=t}}this.geometry.elementsNeedUpdate=!0}};var n=class{constructor(e){let t=new THREE.Geometry,s=new THREE.LineBasicMaterial({color:"white"});for(let e=-15;e<=15;e+=1)t.vertices.push(new THREE.Vector3(-15,-.04,e)),t.vertices.push(new THREE.Vector3(15,-.04,e)),t.vertices.push(new THREE.Vector3(e,-.04,-15)),t.vertices.push(new THREE.Vector3(e,-.04,15));this.line=new THREE.Line(t,s,THREE.LineSegments),e.add(this.line)}};const h={red:"0xFF0000",blue:"0x0000FF",yellow:"0xFFFF00",green:"0x00FF00"};var r=class{constructor(e,t,s,i){this.color=h[s],this.geometry=new THREE.SphereGeometry(.5,7,10),this.material=new THREE.MeshBasicMaterial,this.sphereShape=new THREE.Mesh(this.geometry,this.material),this.sphereShape.material.color.setHex(this.color),this.sphereShape.name=i,this.sphereShape.position.set(t,.5,4),this.moveForward=this.moveForward.bind(this)}moveForward(e){this.sphereShape.position.z>8?this.sphereShape.position.z=4:this.sphereShape.position.z+=e}colorSwitch(){this.sphereShape.position.z>=7?this.sphereShape.material.color.setHex("0x00FFFF"):this.sphereShape.material.color.setHex(this.colors[this.color])}};var a=function(){let e=this;e.key1=[!1,0],e.key2=[!1,0],e.key3=[!1,0],e.key4=[!1,0],document.addEventListener("keydown",t=>{"d"===t.key&&(e.key1[0]=!0,e.key1[1]+=1),"f"===t.key&&(e.key2[0]=!0,e.key2[1]+=1),"j"===t.key&&(e.key3[0]=!0,e.key3[1]+=1),"k"===t.key&&(e.key4[0]=!0,e.key4[1]+=1),32===t.which&&t.preventDefault()}),document.addEventListener("keyup",t=>{"d"===t.key&&(e.key1=[!1,0]),"f"===t.key&&(e.key2=[!1,0]),"j"===t.key&&(e.key3=[!1,0]),"k"===t.key&&(e.key4=[!1,0])})};var o=class{constructor(e){let t=new THREE.FontLoader;this.scene=e,this.titleCreate=this.titleCreate.bind(this);t.load("assets/Dream MMA_Regular.typeface.json",e=>{this.titleCreate(e)})}titleCreate(e){let t=new THREE.TextGeometry("vibe",{font:e,size:1,height:1,curveSegments:3}),s=[new THREE.MeshPhongMaterial({color:2527479,flatShading:!0}),new THREE.MeshPhongMaterial({color:413074})];this.titleRender=new THREE.Mesh(t,s),this.titleRender.name="title",this.titleRender.position.z=-4,this.titleRender.position.x=-2.25,this.titleRender.position.y=5,this.scene.add(this.titleRender);let i=new THREE.DirectionalLight(16777215);i.position.set(2,3,2),window.light=i,this.scene.add(i)}zoomIn(){this.titleRender&&this.titleRender.position.z<4&&(this.titleRender.position.z+=.25)}};var c=class{constructor(e,t,s,i){this.color=h[s],this.geometry=new THREE.CylinderGeometry(.5,.5,.25,32),this.material=new THREE.MeshBasicMaterial,this.cylinderShape=new THREE.Mesh(this.geometry,this.material),this.cylinderShape.material.color.setHex(this.color),this.cylinderShape.name=i,this.cylinderShape.position.set(t,0,7.4),e.add(this.cylinderShape)}colorSwitch(){this.cylinderShape.material.color.setHex("0x00FFFF"),setTimeout(()=>this.cylinderShape.material.color.setHex(this.color),250)}};var l=class{constructor(e,t){this.score=t,this.playerInput=new a,this.canvas=e,this.scene=new THREE.Scene,this.container=document.getElementsByClassName("game-container")[0],this.setCamera(),this.renderer=new THREE.WebGLRenderer({canvas:this.canvas}),this.renderer.setSize(this.container.clientWidth,this.container.clientHeight),this.animate=this.animate.bind(this),this.introAnimate=this.introAnimate.bind(this),this.id,this.openingElements(),this.introAnimate(),window.addEventListener("resize",()=>this.onWindowResize(),!1),this.startRound=this.startRound.bind(this)}openingElements(){this.controls=new o(this.scene),this.line=new n(this.scene)}inGameElements(){this.keyspeed=.05,this.sphere=new i,this.scene.add(this.sphere.sphereShape),this.hitZone1=new c(this.scene,-1.5,"red","hitZone1"),this.hitZone2=new c(this.scene,-.5,"green","hitZone2"),this.hitZone3=new c(this.scene,.5,"blue","hitZone3"),this.hitZone4=new c(this.scene,1.5,"yellow","hitZone4"),this.key1=new r(this.scene,-1.5,"red","1"),this.key2=new r(this.scene,-.5,"green","2"),this.key3=new r(this.scene,.5,"blue","3"),this.key4=new r(this.scene,1.5,"yellow","4")}onWindowResize(){this.renderer.setSize(this.container.clientWidth,this.container.clientHeight),this.camera.aspect=this.canvas.width/this.canvas.height,this.camera.updateProjectionMatrix()}introAnimate(){this.renderer.render(this.scene,this.camera),this.controls.zoomIn(),this.id=window.requestAnimationFrame(this.introAnimate)}animate(){let{maxFreq:e,set2Ave:t,set3Ave:s,set4Ave:i}=this.music.fetchNewFrequencies();if(this.sphere.colorSwitch(e),this.moveKeys(e,t,s,i),this.speedUp(),this.keyCheck(),this.renderer.render(this.scene,this.camera),this.sphere.sphereShape.rotation.x+=.01,this.sphere.sphereShape.rotation.y+=.01,this.currentSong.currentTime===this.musicDuration){return this.restartRound(),u.scoreUpdate(this.score),void document.getElementsByClassName("song-selection")[0].classList.remove("hide")}this.id=window.requestAnimationFrame(this.animate)}moveKeys(e,t,s,i){for(let n=1;n<5;n++)this.scene.children.some(h=>{h.name===n.toString()?h.position.z>=8?(h.position.z=4,this.scene.remove(h)):(1===n&&this.key1.moveForward(this.keyspeed),2===n&&this.key2.moveForward(this.keyspeed),3===n&&this.key3.moveForward(this.keyspeed),4===n&&this.key4.moveForward(this.keyspeed)):(255===e&&this.scene.add(this.key1.sphereShape),t>180&&this.scene.add(this.key2.sphereShape),s>150&&s<180&&this.scene.add(this.key3.sphereShape),i>120&&i<180&&this.scene.add(this.key4.sphereShape))})}speedUp(){let e=parseFloat(this.music.mediaElement.currentTime.toFixed(2));this.musicMarkers[0]<=e&&(this.keyspeed+=.01,this.musicMarkers.shift())}keyCheck(){!0===this.playerInput.key1[0]&&this.key1.sphereShape.position.z>=7.4&&this.key1.sphereShape.position.z<=7.8&&1===this.playerInput.key1[1]&&(this.score+=20,this.hitZone1.colorSwitch(),u.scoreUpdate(this.score),this.key1.sphereShape.position.z=4,this.scene.remove(this.key1.sphereShape)),!0===this.playerInput.key2[0]&&this.key2.sphereShape.position.z>=7.4&&this.key2.sphereShape.position.z<=7.8&&1===this.playerInput.key2[1]&&(this.score+=20,this.hitZone2.colorSwitch(),u.scoreUpdate(this.score),this.key2.sphereShape.position.z=4,this.scene.remove(this.key2.sphereShape)),!0===this.playerInput.key3[0]&&this.key3.sphereShape.position.z>=7.4&&this.key3.sphereShape.position.z<=7.8&&1===this.playerInput.key3[1]&&(this.score+=20,this.hitZone3.colorSwitch(),u.scoreUpdate(this.score),this.key3.sphereShape.position.z=4,this.scene.remove(this.key3.sphereShape)),!0===this.playerInput.key4[0]&&this.key4.sphereShape.position.z>=7.4&&this.key4.sphereShape.position.z<=7.8&&1===this.playerInput.key4[1]&&(this.score+=20,this.hitZone4.colorSwitch(),u.scoreUpdate(this.score),this.key4.sphereShape.position.z=4,this.scene.remove(this.key4.sphereShape))}clearExistingKeys(){this.scene.remove(this.key1.sphereShape),this.scene.remove(this.key2.sphereShape),this.scene.remove(this.key3.sphereShape),this.scene.remove(this.key4.sphereShape)}restartRound(){this.clearExistingKeys(),this.score=0,this.currentSong.pause(),this.currentSong.currentTime=0,this.scene.remove(this.sphere.sphereShape),this.stopAnimation()}setCamera(){this.camera=new THREE.PerspectiveCamera(90,this.canvas.width/this.canvas.height,.1,1e3),this.camera.position.z=10,this.camera.position.y=2}stopAnimation(){window.cancelAnimationFrame(this.id)}startRound(){this.musicDuration=this.currentSong.duration;let e=parseFloat((this.musicDuration/4).toFixed(2));this.musicMarkers=[e,2*e,3*e],this.inGameElements(),this.animate()}renderFrame(e){this.music=e,this.currentSong=this.music.mediaElement,this.currentSong.addEventListener("loadedmetadata",e=>{this.startRound()})}};var d=class{constructor(e){this.listener=new THREE.AudioListener,this.audio=new THREE.Audio(this.listener),window.audio=this.audio,this.mediaElement=new Audio("assets/"+e),this.mediaElement.autoplay=!1,this.audio.setMediaElementSource(this.mediaElement),this.analyser=new THREE.AudioAnalyser(this.audio,1024),window.analyser=this.analyser}fetchNewFrequencies(){this.analyser.getFrequencyData(),this.analyser.needsUpdate=!0;let e=this.analyser.data.slice(0,16),t=this.analyser.data.slice(16,32),s=this.analyser.data.slice(32,48),i=this.analyser.data.slice(48,62),n=t.reduce((e,t)=>e+t,0)/t.length,h=s.reduce((e,t)=>e+t,0)/s.length,r=i.reduce((e,t)=>e+t,0)/i.length;return{maxFreq:e[2],set2Ave:n,set3Ave:h,set4Ave:r}}};class p{constructor(){this.canvas=document.getElementById("canvas"),this.stopButton=document.getElementById("stop-button"),this.audio=document.getElementById("audio"),this.score=0,document.getElementById("score-value").innerText=this.score,this.visualInit(),this.createSongList(),this.gamePaused=!0,this.curSongUrl=null,this.pauseGame(),this.setMenuEvents(),this.togglePause=this.togglePause.bind(this),this.playRound=this.playRound.bind(this),this.jumpToMainMenu=this.jumpToMainMenu.bind(this)}pauseGame(){this.pauseMenu=document.getElementById("pause-menu"),document.addEventListener("keydown",e=>{32===e.which&&this.togglePause()})}togglePause(){this.gamePaused?this.gamePaused&&(this.currentSong.play(),this.visualizer.animate(),this.pauseMenu.classList.toggle("hide-menu"),this.gamePaused=!1):(this.currentSong.pause(),this.visualizer.stopAnimation(),this.pauseMenu.classList.toggle("hide-menu"),this.gamePaused=!0)}restartCurrentSong(){this.togglePause(),this.visualizer.restartRound(),this.score=0,this.gamePaused=!0,p.scoreUpdate(this.score),this.playRound(this.curSongUrl)}jumpToMainMenu(){this.togglePause(),this.visualizer.restartRound();let e=document.getElementsByClassName("song-selection")[0];this.score=0,this.gamePaused=!0,p.scoreUpdate(this.score),e.classList.remove("hide")}createSongList(){let e=document.getElementById("song-list");["Dont Wanna Know","Feel So Close","Finesse","Starboy"].forEach(t=>{let s=document.createElement("li");s.append(t),s.onclick=()=>{this.curSongUrl=t,this.playRound(t)},e.append(s)})}setMenuEvents(){let e=document.getElementById("resume"),t=document.getElementById("restart"),s=document.getElementById("quit");e.addEventListener("click",()=>{this.togglePause()}),t.addEventListener("click",()=>{this.restartCurrentSong()}),s.addEventListener("click",()=>{this.jumpToMainMenu()})}static scoreUpdate(e){document.getElementById("score-value").innerText=e}visualInit(){this.visualizer=new l(this.canvas,this.score)}playRound(e){if(!0===this.gamePaused){this.gamePaused=!1,this.music=new d(e+".mp3"),document.getElementsByClassName("song-selection")[0].classList.add("hide"),this.currentSong=this.music.mediaElement,this.currentSong.play(),this.visualizer.renderFrame(this.music)}}}var u=p;s(0);window.addEventListener("DOMContentLoaded",()=>{new u})}]);
//# sourceMappingURL=main.js.map